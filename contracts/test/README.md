# ERC20Template Test Suite

这个测试套件为 ERC20Template 合约提供了全面的 TDD（测试驱动开发）测试覆盖。

## 测试文件结构

### 1. ERC20Template.t.sol
基础 ERC20 功能测试，包括：
- **初始化测试**: 参数验证、单次初始化、错误处理
- **元数据测试**: name, symbol, decimals, totalSupply
- **余额测试**: 初始余额分配、零余额验证
- **转账测试**: 基本转账、余额不足、零地址、零金额
- **授权测试**: approve, allowance, 零地址验证
- **授权转账测试**: transferFrom, 余额不足, 授权不足
- **所有权测试**: owner, transferOwnership, renounceOwnership
- **功能标志测试**: isMintable, isBurnable, isPausable, isCapped
- **XSC网络兼容性测试**: 大额供应量、大额转账、最大供应量限制
- **Gas优化测试**: 转账和授权的Gas使用量
- **模糊测试**: 随机金额的转账和授权
- **不变量测试**: 总供应量保持不变、余额总和等于总供应量

### 2. ERC20TemplateAdvanced.t.sol
高级功能测试（铸造/销毁/暂停），包括：

#### 铸造功能测试
- 基本铸造、仅所有者权限、未启用铸造时的错误
- 零金额铸造、零地址铸造

#### 限额铸造测试
- 限额内铸造、超出限额、精确限额、无效最大供应量

#### 销毁功能测试
- 基本销毁、未启用销毁时的错误、余额不足、零金额销毁
- 授权销毁（burnFrom）、授权不足

#### 暂停功能测试
- 基本暂停/取消暂停、仅所有者权限、未启用暂停时的错误
- 暂停状态下的转账限制、铸造/销毁限制

#### 组合功能测试
- 所有功能同时启用、铸造和销毁工作流
- 暂停状态阻止所有转账

#### XSC网络高级测试
- 大额限额铸造、高频操作、Gas优化测试

#### 模糊测试和不变量测试
- 随机金额的铸造和销毁
- 暂停状态下阻止转账、总供应量不超过限额、仅所有者能使用特权功能

### 3. ERC20TemplateInit.t.sol
初始化模式测试，包括：

#### 初始化验证测试
- 有效配置、空名称/符号、零总供应量、零所有者
- 无效小数位数、限额但无最大供应量、最大供应量低于初始供应量
- 长名称和符号

#### 单次初始化测试
- 仅允许一次初始化、防止重新初始化

#### 代理模式测试
- 克隆模式基础测试、创建代币、多个代币、独立状态
- 代理检测、工厂集成

#### 工厂集成测试
- 模板管理、不存在的模板、功能组合初始化

#### XSC网络初始化测试
- 大规模部署、最大供应量限制、Gas优化测试

#### 边缘情况测试
- 特殊字符、Unicode字符、错误恢复

#### 模糊测试和不变量测试
- 随机供应量和小数位数、初始化代币的有效状态

## TDD 方法论

### 当前状态
所有测试都使用 MockERC20Template* 合约作为占位符，这些合约**故意不完整**以确保：

1. **测试先行**: 测试在实现之前编写
2. **失败驱动**: 初始运行所有测试都会失败
3. **需求明确**: 测试定义了准确的功能需求
4. **逐步实现**: 实现将被测试驱动

### 运行测试

```bash
# 安装 Foundry (如果尚未安装)
curl -L https://foundry.paradigm.xyz | bash
foundryup

# 运行所有 ERC20Template 测试 (预期会失败)
forge test --match-path "test/ERC20Template*.sol"

# 运行特定测试文件
forge test --match-path "test/ERC20Template.t.sol"
forge test --match-path "test/ERC20TemplateAdvanced.t.sol"
forge test --match-path "test/ERC20TemplateInit.t.sol"

# 运行带详细输出的测试
forge test --match-path "test/ERC20Template*.sol" -vvv

# 运行特定测试函数
forge test --match-test "test_Transfer_Basic"
```

### 实现流程

1. **运行测试**: 验证所有测试都失败
2. **实现接口**: 创建 IERC20Template.sol 接口
3. **实现基础合约**: 创建 ERC20Template.sol 实现
4. **逐个功能**: 按测试顺序实现功能
5. **验证通过**: 确保所有测试通过
6. **重构优化**: 在测试保护下优化代码

## XSC 网络兼容性

所有测试都包含 XSC 网络特定的验证：

- **Gas 限制**: 测试确保操作在 XSC 网络 Gas 限制内
- **块时间**: 考虑 3 秒块时间的测试
- **最大供应量**: 测试大数值兼容性
- **EVM 兼容性**: 使用 Solidity 0.8.20 确保兼容性

## 测试覆盖范围

- **功能覆盖**: 100% 的 IERC20Template 接口功能
- **边缘情况**: 零值、最大值、错误条件
- **权限检查**: 所有访问控制验证
- **Gas 效率**: 所有操作的 Gas 使用量验证
- **不变量**: 系统状态一致性检查
- **模糊测试**: 随机输入的鲁棒性测试

## 预期错误

在实现完成之前，测试将产生以下类型的错误：

1. **合约不存在错误**: Mock 合约缺少实际实现
2. **函数不存在错误**: 接口函数未实现
3. **断言失败**: 期望行为与空实现不匹配
4. **还原错误**: 预期的错误条件未正确处理

这些错误是 TDD 流程的正常部分，将在实现过程中逐步解决。